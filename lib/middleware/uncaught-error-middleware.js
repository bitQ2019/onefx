"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true,
});
exports.uncaughtErrorMiddleware = uncaughtErrorMiddleware;

function uncaughtErrorMiddleware(server) {
  return async (ctx, next) => {
    try {
      await next();
    } catch (err) {
      if (ctx.message) {
        throw err;
      }

      ctx.status = err.status || 500;
      ctx.body = "internal server error";
      server.logger.error(`internal server error: ${err.stack}`);
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL3VuY2F1Z2h0LWVycm9yLW1pZGRsZXdhcmUudHMiXSwibmFtZXMiOlsidW5jYXVnaHRFcnJvck1pZGRsZXdhcmUiLCJzZXJ2ZXIiLCJjdHgiLCJuZXh0IiwiZXJyIiwibWVzc2FnZSIsInN0YXR1cyIsImJvZHkiLCJsb2dnZXIiLCJlcnJvciIsInN0YWNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBR08sU0FBU0EsdUJBQVQsQ0FBaUNDLE1BQWpDLEVBQTZEO0FBQ2xFLFNBQU8sT0FBT0MsR0FBUCxFQUFxQkMsSUFBckIsS0FBd0M7QUFDN0MsUUFBSTtBQUNGLFlBQU1BLElBQUksRUFBVjtBQUNELEtBRkQsQ0FFRSxPQUFPQyxHQUFQLEVBQVk7QUFDWixVQUFJRixHQUFHLENBQUNHLE9BQVIsRUFBaUI7QUFDZixjQUFNRCxHQUFOO0FBQ0Q7O0FBQ0RGLE1BQUFBLEdBQUcsQ0FBQ0ksTUFBSixHQUFhRixHQUFHLENBQUNFLE1BQUosSUFBYyxHQUEzQjtBQUNBSixNQUFBQSxHQUFHLENBQUNLLElBQUosR0FBVyx1QkFBWDtBQUNBTixNQUFBQSxNQUFNLENBQUNPLE1BQVAsQ0FBY0MsS0FBZCxDQUFxQiwwQkFBeUJMLEdBQUcsQ0FBQ00sS0FBTSxFQUF4RDtBQUNEO0FBQ0YsR0FYRDtBQVlEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VydmVyIH0gZnJvbSBcIi4uL3NlcnZlclwiO1xuaW1wb3J0IHsgQ29udGV4dCwgTWlkZGxld2FyZSB9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gdW5jYXVnaHRFcnJvck1pZGRsZXdhcmUoc2VydmVyOiBTZXJ2ZXIpOiBNaWRkbGV3YXJlIHtcbiAgcmV0dXJuIGFzeW5jIChjdHg6IENvbnRleHQsIG5leHQ6IEZ1bmN0aW9uKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG5leHQoKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmIChjdHgubWVzc2FnZSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBjdHguc3RhdHVzID0gZXJyLnN0YXR1cyB8fCA1MDA7XG4gICAgICBjdHguYm9keSA9IFwiaW50ZXJuYWwgc2VydmVyIGVycm9yXCI7XG4gICAgICBzZXJ2ZXIubG9nZ2VyLmVycm9yKGBpbnRlcm5hbCBzZXJ2ZXIgZXJyb3I6ICR7ZXJyLnN0YWNrfWApO1xuICAgIH1cbiAgfTtcbn1cbiJdfQ==
