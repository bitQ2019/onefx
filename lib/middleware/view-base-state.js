"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true,
});
exports.viewBaseState = viewBaseState;

var _deepExtend = _interopRequireDefault(require("deep-extend"));

var _dottie = _interopRequireDefault(require("dottie"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function viewBaseState(server) {
  return async (ctx, next) => {
    ctx.state.view = {
      base: {
        analytics: server.config.analytics || {},
        csrfToken: ctx.csrf,
        routePrefix: server.config.server.routePrefix,
        cdnBase: server.config.server.cdnBase,
      },
    };

    ctx.deepExtendState = (newState) => {
      ctx.state.view = (0, _deepExtend.default)({}, ctx.state.view, newState);
    };

    ctx.setState = (path, val) => {
      _dottie.default.set(ctx.state.view, path, val);
    };

    ctx.getState = (path) => {
      if (path) {
        return _dottie.default.get(ctx.state.view, path);
      }

      return ctx.state.view;
    };

    return next();
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL3ZpZXctYmFzZS1zdGF0ZS50cyJdLCJuYW1lcyI6WyJ2aWV3QmFzZVN0YXRlIiwic2VydmVyIiwiY3R4IiwibmV4dCIsInN0YXRlIiwidmlldyIsImJhc2UiLCJhbmFseXRpY3MiLCJjb25maWciLCJjc3JmVG9rZW4iLCJjc3JmIiwicm91dGVQcmVmaXgiLCJjZG5CYXNlIiwiZGVlcEV4dGVuZFN0YXRlIiwibmV3U3RhdGUiLCJzZXRTdGF0ZSIsInBhdGgiLCJ2YWwiLCJkb3R0eSIsInNldCIsImdldFN0YXRlIiwiZ2V0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFNTyxTQUFTQSxhQUFULENBQXVCQyxNQUF2QixFQUFtRDtBQUN4RCxTQUFPLE9BQU9DLEdBQVAsRUFBcUJDLElBQXJCLEtBQW9DO0FBQ3pDRCxJQUFBQSxHQUFHLENBQUNFLEtBQUosQ0FBVUMsSUFBVixHQUFpQjtBQUNmQyxNQUFBQSxJQUFJLEVBQUU7QUFDSkMsUUFBQUEsU0FBUyxFQUFFTixNQUFNLENBQUNPLE1BQVAsQ0FBY0QsU0FBZCxJQUEyQixFQURsQztBQUVKRSxRQUFBQSxTQUFTLEVBQUVQLEdBQUcsQ0FBQ1EsSUFGWDtBQUdKQyxRQUFBQSxXQUFXLEVBQUVWLE1BQU0sQ0FBQ08sTUFBUCxDQUFjUCxNQUFkLENBQXFCVSxXQUg5QjtBQUlKQyxRQUFBQSxPQUFPLEVBQUVYLE1BQU0sQ0FBQ08sTUFBUCxDQUFjUCxNQUFkLENBQXFCVztBQUoxQjtBQURTLEtBQWpCOztBQVNBVixJQUFBQSxHQUFHLENBQUNXLGVBQUosR0FBdUJDLFFBQUQsSUFBNEI7QUFDaERaLE1BQUFBLEdBQUcsQ0FBQ0UsS0FBSixDQUFVQyxJQUFWLEdBQWlCLHlCQUFXLEVBQVgsRUFBZUgsR0FBRyxDQUFDRSxLQUFKLENBQVVDLElBQXpCLEVBQStCUyxRQUEvQixDQUFqQjtBQUNELEtBRkQ7O0FBSUFaLElBQUFBLEdBQUcsQ0FBQ2EsUUFBSixHQUFlLENBQUNDLElBQUQsRUFBZUMsR0FBZixLQUFxQztBQUNsREMsc0JBQU1DLEdBQU4sQ0FBVWpCLEdBQUcsQ0FBQ0UsS0FBSixDQUFVQyxJQUFwQixFQUEwQlcsSUFBMUIsRUFBZ0NDLEdBQWhDO0FBQ0QsS0FGRDs7QUFJQWYsSUFBQUEsR0FBRyxDQUFDa0IsUUFBSixHQUFnQkosSUFBRCxJQUF3QjtBQUNyQyxVQUFJQSxJQUFKLEVBQVU7QUFDUixlQUFPRSxnQkFBTUcsR0FBTixDQUFVbkIsR0FBRyxDQUFDRSxLQUFKLENBQVVDLElBQXBCLEVBQTBCVyxJQUExQixDQUFQO0FBQ0Q7O0FBQ0QsYUFBT2QsR0FBRyxDQUFDRSxLQUFKLENBQVVDLElBQWpCO0FBQ0QsS0FMRDs7QUFPQSxXQUFPRixJQUFJLEVBQVg7QUFDRCxHQTFCRDtBQTJCRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBkZWVwRXh0ZW5kIGZyb20gXCJkZWVwLWV4dGVuZFwiO1xuaW1wb3J0IGRvdHR5IGZyb20gXCJkb3R0aWVcIjtcbmltcG9ydCB7IENvbnRleHQgfSBmcm9tIFwia29hXCI7XG5cbmltcG9ydCB7IFNlcnZlciB9IGZyb20gXCIuLi9zZXJ2ZXJcIjtcbmltcG9ydCB7IE1pZGRsZXdhcmUsIE5leHQgfSBmcm9tIFwiLi4vdHlwZXNcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHZpZXdCYXNlU3RhdGUoc2VydmVyOiBTZXJ2ZXIpOiBNaWRkbGV3YXJlIHtcbiAgcmV0dXJuIGFzeW5jIChjdHg6IENvbnRleHQsIG5leHQ6IE5leHQpID0+IHtcbiAgICBjdHguc3RhdGUudmlldyA9IHtcbiAgICAgIGJhc2U6IHtcbiAgICAgICAgYW5hbHl0aWNzOiBzZXJ2ZXIuY29uZmlnLmFuYWx5dGljcyB8fCB7fSxcbiAgICAgICAgY3NyZlRva2VuOiBjdHguY3NyZixcbiAgICAgICAgcm91dGVQcmVmaXg6IHNlcnZlci5jb25maWcuc2VydmVyLnJvdXRlUHJlZml4LFxuICAgICAgICBjZG5CYXNlOiBzZXJ2ZXIuY29uZmlnLnNlcnZlci5jZG5CYXNlXG4gICAgICB9XG4gICAgfTtcblxuICAgIGN0eC5kZWVwRXh0ZW5kU3RhdGUgPSAobmV3U3RhdGU6IG9iamVjdCk6IHZvaWQgPT4ge1xuICAgICAgY3R4LnN0YXRlLnZpZXcgPSBkZWVwRXh0ZW5kKHt9LCBjdHguc3RhdGUudmlldywgbmV3U3RhdGUpO1xuICAgIH07XG5cbiAgICBjdHguc2V0U3RhdGUgPSAocGF0aDogc3RyaW5nLCB2YWw6IG9iamVjdCk6IHZvaWQgPT4ge1xuICAgICAgZG90dHkuc2V0KGN0eC5zdGF0ZS52aWV3LCBwYXRoLCB2YWwpO1xuICAgIH07XG5cbiAgICBjdHguZ2V0U3RhdGUgPSAocGF0aDogc3RyaW5nKTogdm9pZCA9PiB7XG4gICAgICBpZiAocGF0aCkge1xuICAgICAgICByZXR1cm4gZG90dHkuZ2V0KGN0eC5zdGF0ZS52aWV3LCBwYXRoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjdHguc3RhdGUudmlldztcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfTtcbn1cbiJdfQ==
